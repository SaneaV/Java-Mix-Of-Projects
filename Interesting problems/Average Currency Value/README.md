This program is necessary to demonstrate the work with currencies (sale and purchase). You need to specify the amount of the currency bought or sold (with a minus sign) and the transaction price. Further, the program itself calculates the average currency purchase rate.

How is the calculation of the average cost of buying a currency, if some part was sold earlier:

If you sell part of the currency, then the average purchase price of the remaining position will change. The calculation of the average price will exclude the currency received as a result of transactions that were made earlier than the others. That is, the new average price will be calculated based on the prices of the transactions that you made last.

For example, you bought $10 at 80 ₽, and after some time, another $15 at 85 ₽. In total, you will have $25 in your account. The average purchase price is: (10 × 80 + 15 × 85) / (10 + 15) = 83 ₽.

Next, you sold $8 at any price. The account balance is $17. The average price will be calculated based on the last $17 credited to the account. That is, $15 purchased for 85 ₽, and another $2 purchased for 80 ₽.

The new average price will be: (2 × 80 + 15 × 85) / 17 = 84.41 ₽.

Similarly, the average price changes when a currency is withdrawn from a brokerage account. All events that reduce the currency position are counted as a sale of the currency.

Attention: It is assumed that you initially bought the currency and only then sold it. You cannot sell more currency than you bought.